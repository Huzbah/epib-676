<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.0.37">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="YOUR NAME HERE">

<title>Assignment 0: Coding simple models</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="assign0_getting-started_files/libs/clipboard/clipboard.min.js"></script>
<script src="assign0_getting-started_files/libs/quarto-html/quarto.js"></script>
<script src="assign0_getting-started_files/libs/quarto-html/popper.min.js"></script>
<script src="assign0_getting-started_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="assign0_getting-started_files/libs/quarto-html/anchor.min.js"></script>
<link href="assign0_getting-started_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="assign0_getting-started_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="assign0_getting-started_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="assign0_getting-started_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="assign0_getting-started_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Assignment 0: Coding simple models</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>YOUR NAME HERE </p>
          </div>
  </div>
    
    
  </div>
  

</header>

<p>This assignment aims to be a fairly gentle introduction to the types of models we’ll cover in this class. It is self-contained, meaning students can complete it before attending lecture to get a sense of whether the class interests them. While this assignment should give a feel for future assignments, the coding component is lighter, with a lot of the code pre-written and a lot of hints.</p>
<p>To turn in the completed assignment, please upload the html document created when you render the .qmd file to MyCourses.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#load necessary packages. IF they aren't installed, type install.packages(c("ggplot2","tidyr")) into your console</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="section-1-monty-hall-problem" class="level2">
<h2 class="anchored" data-anchor-id="section-1-monty-hall-problem">Section 1: Monty Hall problem</h2>
<p>The Monty Hall problem is a classic probability brain riddle. It’s named after Canadian game show host Monty Hall from the 1980’s game show <em>Let’s Make a Deal</em>. Here’s the problem:</p>
<blockquote class="blockquote">
<p>You have three doors in front of you. The host tells you that a car is behind one, and a goat is behind the other two. You will get to open one door, and if it’s a car, you win! The host lets you make an initial choice, so you select a door. Then, the host tells you they will reduce your options by eliminating one of the other doors. They open a door (not the one you picked) and reveal a goat. Now they give you a second choice: would you like to open the door you selected originally (stick), or change to the other door that they haven’t eliminated (switch)? If you pick the door with the car, you win it. What is the better decision?</p>
</blockquote>
<p>Take a minute to think about the problem. What do you think the answer is?</p>
<p>Most people find the answer counter-intuitive, at least until they work through it themselves. In the next two sections, you’ll solve this problem with two different modeling tools from the class: with Monte Carlo simulation and decision trees.</p>
<section id="section-1a-solving-monty-hall-with-simulation" class="level3">
<h3 class="anchored" data-anchor-id="section-1a-solving-monty-hall-with-simulation">Section 1A: Solving Monty Hall with simulation</h3>
<p>Monte Carlo simulation is a way to estimate the probability distribution of an outcome from a probabilistic event with known (or assumed) structure. This is done by generating many manifestations of the probabilistic event and then analyzing the proportion of times each possible outcome appeared.</p>
<p>For most health-related decision problems, the inputs to the model must be estimated. In the case of the Monty Hall problem, we can derive the exact inputs from the structure of the problem:</p>
<ul>
<li><p>The car is equally likely to be behind any of the three doors, so our original choice has a 1 in 3 chance of being correct</p></li>
<li><p>Monty will always eliminate an option by opening a door that is not your choice and does not contain the car</p></li>
<li><p>If our initial choice is correct, we will win if we stick with it</p></li>
<li><p>If our initial choice was incorrect, since Monty eliminated one of the two other choices, we will always win if we switch</p></li>
</ul>
<p>In the following code block, simulate a single instance of the Monty Hall problem by replacing the ’NA’s with code that functions as described in the comments. Then, run the block of code.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Randomly assign the prize to a door. Replace NA with a function that will return the number 1, 2, or 3 with equal probability. Hint: type ?sample in the console</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>prize <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Randomly pick a door. Should also be 1, 2, or 3 with equal probability</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>choice <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co"># List Monte's options for which door to reveal. He cannot reveal your choice or the door with the car (could be the same door). Start with the list 1, 2, or 3, but then remove the option(s) corresponding to the prize and to your choice.</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>monty_options <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Randomly select one of the doors in Monte's options for him to reveal</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>monty_reveal <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="co">#Assign the variable optimal_choice with 'stay' if it's better to stay with your choice and with 'switch' if it's better to switch. Type ?ifelse into the console for help.</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>optimal_choice <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Check your output by printing each variable to the console. Rerun this whole code chunk multiple times and then look at the printed variables to make sure you see what you expect.</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">c</span>(</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste0</span>(<span class="st">"Prize: door "</span>, prize), </span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste0</span>(<span class="st">"Your choice: door "</span>, choice),</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste0</span>(<span class="st">"Monty's options: doors "</span>, <span class="fu">paste</span>(monty_options, <span class="at">collapse=</span><span class="st">","</span>)),</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste0</span>(<span class="st">"Monty's reveal: door "</span>, monty_reveal),</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste0</span>(<span class="st">"Optimal choice: "</span>, optimal_choice)</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Prize: door NA"            "Your choice: door NA"     
[3] "Monty's options: doors NA" "Monty's reveal: door NA"  
[5] "Optimal choice: NA"       </code></pre>
</div>
</div>
<p>Monte Carlo simulations involve re-running a scenario over and over to estimate the probability of different outcomes. In R, functions are used for bits of code we plan to use multiple times. Functions usually have both inputs and an output, but in this case we will use a function with no inputs. In this code chunk, copy and paste bits of your code from the previous chunk into the function. Then run the function 10 times to make sure it seems to be working.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Inputs: none</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co">#Outputs: Optimal choice ("stay" or switch")</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>monty_hall <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  optimal_choice<span class="ot">=</span><span class="cn">NA</span> <span class="co">#replace this with the proper code</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(optimal_choice)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="co">#Run the function 10 times</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (run <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>){</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">monty_hall</span>())</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] NA
[1] NA
[1] NA
[1] NA
[1] NA
[1] NA
[1] NA
[1] NA
[1] NA
[1] NA</code></pre>
</div>
</div>
<p>Now, we will repeat the simulation several times. If we run it enough times, the proportion of simulation runs for which the player should switch doors should approximate the probability switching is better, at least if our sample size is sufficiently large. In this code chunk, replicate the simulation 100,000 times.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>N_reps <span class="ot">=</span> <span class="dv">100000</span> <span class="co">#number of replications</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co">#create a vector of 'NA's of length N_reps. Hint: type ?rep into the console</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>Sim_outcomes <span class="ot">&lt;-</span> <span class="cn">NA</span> </span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(rep <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>N_reps){</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Replace the rep'th entry of Sim_outcomes with the outcome of a monty_hall simulation</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="cn">NA</span> </span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="co">#Check your work by looking at the size of Sim_outcomes, the first 5 entries, and the last 5 entries</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(Sim_outcomes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(Sim_outcomes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] NA</code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(Sim_outcomes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] NA</code></pre>
</div>
</div>
<p>To calculate the probability you should switch, add up all of the replications in which the optimal decision was to switch and divide by the number of replications. The proportion of replications for which switching is optimal should approximate the probability that switching is the right decision, as long as our sample size is big enough.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Count entries of Sim_outcomes where the optimal decision was "switch"</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>N_switch <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>P_switch_better <span class="ot">&lt;-</span> N_switch <span class="sc">/</span> N_reps</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="co">#Print these variables to check</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>N_switch</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] NA</code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>P_switch_better</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] NA</code></pre>
</div>
</div>
<p>The result should be close to 0.667 or 2/3. How does this compare to your initial guess?</p>
<p>Monte Carlo simulations become more accurate with higher number of replications. To explore this for the Monty Hall problem, let’s estimate the probability for a range of sample sizes and then plot it.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Create a vector of the simulation sizes we want to analyze</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>sim_sizes <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="dv">10</span><span class="sc">^</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">4</span>), <span class="cf">function</span>(x) x<span class="sc">*</span><span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>) <span class="sc">|&gt;</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unlist</span>()</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="co">#Create an empty list to store the estimated probability switching is better for each simulation size. No need to edit</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>p_switch_better <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (N <span class="cf">in</span> sim_sizes){</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Calculate the probability switching is better on the first N replications in the vector Sim_outcomes. Hint: can google 'subsetting vectors in R'</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>  P_switch_better_subset <span class="ot">&lt;-</span> <span class="dv">0</span><span class="co">#Repalce the 0</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Append the result to p_est_switch_better</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>  p_switch_better <span class="ot">&lt;-</span> <span class="fu">c</span>(p_switch_better, P_switch_better_subset)</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a><span class="co">#Code from here down does not need to be edited; it should work if everything above is correct. But take a look and try and understand it!</span></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a><span class="co">#Create a dataframe</span></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>df_sim_size_outcomes <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">n =</span> sim_sizes,</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">p_switch_better =</span> p_switch_better</span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a><span class="co">#Print the dataframe</span></span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>df_sim_size_outcomes</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       n p_switch_better
1  1e+00               0
2  2e+00               0
3  3e+00               0
4  4e+00               0
5  5e+00               0
6  6e+00               0
7  7e+00               0
8  8e+00               0
9  9e+00               0
10 1e+01               0
11 1e+01               0
12 2e+01               0
13 3e+01               0
14 4e+01               0
15 5e+01               0
16 6e+01               0
17 7e+01               0
18 8e+01               0
19 9e+01               0
20 1e+02               0
21 1e+02               0
22 2e+02               0
23 3e+02               0
24 4e+02               0
25 5e+02               0
26 6e+02               0
27 7e+02               0
28 8e+02               0
29 9e+02               0
30 1e+03               0
31 1e+03               0
32 2e+03               0
33 3e+03               0
34 4e+03               0
35 5e+03               0
36 6e+03               0
37 7e+03               0
38 8e+03               0
39 9e+03               0
40 1e+04               0
41 1e+04               0
42 2e+04               0
43 3e+04               0
44 4e+04               0
45 5e+04               0
46 6e+04               0
47 7e+04               0
48 8e+04               0
49 9e+04               0
50 1e+05               0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Plot it. </span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> df_sim_size_outcomes,<span class="co">#all ggplots use dataframes</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>       <span class="co">#The x and y values are considered "aesthetics" and are defined in aes()</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>                <span class="fu">aes</span>(<span class="at">x =</span> n, <span class="at">y =</span> p_switch_better))<span class="sc">+</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Add points and lines</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>()<span class="sc">+</span><span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Set x axis to log scale</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>()<span class="sc">+</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>  <span class="co">#theme_bw looks nicer than the ggplot default</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Set the Y axis to range between 0 and 1</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Label the x and y axes</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Sample size N (logarithmic scale)"</span>)<span class="sc">+</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Est. probability that switching is better"</span>)<span class="sc">+</span></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Add a horizontal reference line in red</span></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">2</span><span class="sc">/</span><span class="dv">3</span>, <span class="at">color =</span> <span class="st">"red"</span>)<span class="sc">+</span></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Add a label</span></span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_label</span>(<span class="at">label =</span> <span class="st">"As N increases, estimated probability converges."</span>,</span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>            <span class="at">x =</span> <span class="dv">1</span>,</span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>            <span class="at">y=</span>.<span class="dv">8</span>,</span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>            <span class="at">hjust =</span> <span class="st">"left"</span>,</span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>            <span class="at">color=</span><span class="st">"red"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="assign0_getting-started_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="section-1b-monty-hall-decision-tree" class="level3">
<h3 class="anchored" data-anchor-id="section-1b-monty-hall-decision-tree">Section 1B: Monty Hall decision tree</h3>
<p>Decision trees are great for representing relatively small decision problems where each decision has a discrete set of options and each chance event has a discrete set of possible outcomes, like the roll of a die. In a decision tree, decisions are represented by square decision nodes and chance events are represented by round chance nodes. Branches off of decision node represent your choices, and branches off of a chance node represent possible outcomes. Decision trees without any numbers can be used to illustrate a decision problem. Here’s an example for someone deciding whether or not to bet on the Habs for an upcoming hockey game.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figs/habs_bet_tree.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Decision tree for whether to bet on the Habs in an upcoming hockey game</figcaption><p></p>
</figure>
</div>
<p>Adding numbers to the decision tree allows us to calculate the value of each decision and identify which alternative will maximize our expected benefit. Here’s the same example, but with an estimated/believed probability assigned to each chance event and a value assigned to each outcome. In this example, we believe there’s a 60% probability the Habs win. If we place a bet, we get $90 if they win and lose $100 if they lose. If we don’t bet, the value to us is $0.</p>
<p><img src="figs/habs_bet_tree_quant.png" class="img-fluid"></p>
<p>The expected value of placing a bet is $90*0.6 + -$100*0.4 = $14. This exceeds the $0 in benefit we would get if we didn’t place a bet; in this case, placing the bet would maximize our expected benefit. If we believe there’s only a 50% change the Habs win, the expected value of the bet changes to $90*0.5 + -$100*0.5 = -$5. Since the expected value is less than $0, we should not place the bet (assuming we are risk neutral).</p>
<p>Going back to the Monty Hall problem, one can enumerate every possibility in a decision tree. Below is a nice example from https://doisinkidney.com/posts/2015-08-03-monty-hall.html. While this version didn’t make the distinction, you should be able to figure out which nodes are decisions (usually represented with a square) and which are random chances (usually represented with a circle).</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figs/monty-hall-tree-full.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">The ‘full’ decision tree representation of the Monty Hall problem</figcaption><p></p>
</figure>
</div>
<p>However, we’re going to take advantage of the symmetry of this problem to develop and solve a simpler representation. Because the probability of selecting the door with the car is the same regardless of which door you choose, we can represent it as though you have no choice at all. Using this, we start our decision treee with a chance node that indicates whether our initially selected door has a car or a goat behind it. Next, the host removes one of the remaining options and you have a decision: stick with the existing door or switch.</p>
<p>Here’s a picture of the simplified tree. Shown in red are the r names we will use for the numerical variables we’ll need to define to solve the tree. Those variables are the probability that the initial selection has a car or a goat and the outcome of sticking with your choice or switching, conditioned on whether your originally-selected door has a car or goat behind it.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figs/monty-hall-tree-simple.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Simpler version of the Monty Hall problem decision tree</figcaption><p></p>
</figure>
</div>
<p>Let’s solve the decision tree problem. To do so, we just need to assign numbers (probabilities, outcome values) to the decision tree variables and then do some simple arithmetic.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Define the variables; replace NA with the proper values</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="co">#The probability your initially selected door contains a car or a goat. Must sum to 1.</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>p_car_initial <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>p_goat_initial <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="co">#For outcome variables, use 1 if the decision results in winning the car and 0 otherwise.</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>o_pick_car_then_stick <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>o_pick_car_then_switch <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>o_pick_goat_then_stick <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>o_pick_goat_then_switch <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a><span class="co">#Estimate the expected probability of each outcome depending on whether you stick or you switch. This is a simple calculation where each possible outcome under the decision is weighted by the probability of that outcome. Use the variables you just defined for this computation rather than typing numbers directly.</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>p_car_if_stick <span class="ot">=</span> <span class="cn">NA</span> </span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>p_car_if_switch <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p_car_if_stick)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] NA</code></pre>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p_car_if_switch)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] NA</code></pre>
</div>
</div>
<p>Hopefully this exercise has helped convince you of the Monty Hall problem solution and illustrated why the counter-intuitive result is correct. There are many ways to solve or explain this solution; free to check out the Wikipedia page for others.</p>
</section>
</section>
<section id="section-2-a-cohort-model" class="level2">
<h2 class="anchored" data-anchor-id="section-2-a-cohort-model">Section 2: A cohort model</h2>
<p>In section 2, you will model the health of a cohort of 10,000 individuals over 20 years. Your model will have three health states: Healthy, Sick, and Dead. Individuals will all start healthy, but as time progresses some will get sick and some will die. You will generate a cohort trace plot that shows the percent of individuals in each health state at each timestep. You will perform a simple scenario analysis,and use the model to conduct a simplified health policy analysis, assessing the impact of a hypothetical vaccine.</p>
<p>Let’s get started!</p>
<p>First, we define the model’s parameters. We’ll use a named list l_prms to contain all the parameters. You don’t need to change anything in this code block</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Add all parameters to a named list</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>l_prms <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Initial distribution (number of people in each health state at time 0</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>l_prms<span class="sc">$</span>init_H <span class="ot">&lt;-</span> <span class="dv">10000</span> <span class="co">#healthy</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>l_prms<span class="sc">$</span>init_S <span class="ot">&lt;-</span> <span class="dv">0</span> <span class="co">#sick</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>l_prms<span class="sc">$</span>init_D <span class="ot">&lt;-</span> <span class="dv">0</span> <span class="co">#dead</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a><span class="co">#Use a 30-year time horizon</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>l_prms<span class="sc">$</span>n_timesteps <span class="ot">&lt;-</span> <span class="dv">30</span> </span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a><span class="co">#Annual transition probabilities probability of going from one state to another at each timestep</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>l_prms<span class="sc">$</span>p_H_to_S <span class="ot">&lt;-</span> .<span class="dv">03</span> <span class="co">#healthy to sick</span></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>l_prms<span class="sc">$</span>p_H_to_D <span class="ot">&lt;-</span> .<span class="dv">01</span> <span class="co">#healthy to dead</span></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>l_prms<span class="sc">$</span>p_S_to_H <span class="ot">&lt;-</span> .<span class="dv">02</span> <span class="co">#sick to healthy (recovering)</span></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>l_prms<span class="sc">$</span>p_S_to_D <span class="ot">&lt;-</span> .<span class="dv">07</span> <span class="co">#sick to dead</span></span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a><span class="co">#Print l_prms to see the values</span></span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>l_prms</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$init_H
[1] 10000

$init_S
[1] 0

$init_D
[1] 0

$n_timesteps
[1] 30

$p_H_to_S
[1] 0.03

$p_H_to_D
[1] 0.01

$p_S_to_H
[1] 0.02

$p_S_to_D
[1] 0.07</code></pre>
</div>
</div>
<p>We’re going to develop a Markov model, a simple and commonly-used cohort model. You’ll learn a lot more about these later. For now, know that at each time step, individuals can transition from one state to another. Their probability of transitioning depends only on which state their currently in. We’re going to use a for loop to develop the Markov model; later in the course we’ll learn how to use matrix multiplication for more efficient modeling.</p>
<p>First, we create the matrix where we track our cohort’s transition between the health states over time. This is sometimes called a cohort trace matrix. We can also go fill in the first row of this matrix (timestep 0) with the initial distribution of the cohort using our parameter table.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Create a matrix that contains a 'trace' of how your cohort is distributed across the health states at each point in time.</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="co">#Matrix length: 31 (the number of timesteps + 1)</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Matrix width: 3 (the number of health states; H=healthy, S=sick, and D=dead)</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Matrix type: integer (can fill it with 0s or as.integer(NA))</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="co">#Assign the state names H, S and D as the column names</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="co">#HINTS: type ?matrix into your console. Use the values stored in l_prms where possible</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a><span class="co">#This has errors. Fix it!</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>m_cohort_trace <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">data=</span><span class="fu">as.integer</span>(<span class="cn">NA</span>),</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>                         <span class="at">nrow =</span> <span class="dv">2</span>,</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>                         <span class="at">ncol =</span> <span class="dv">3</span>,</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>                         <span class="at">dimnames =</span> <span class="fu">list</span>(<span class="st">"timestep"</span><span class="ot">=</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>,</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">"state"</span><span class="ot">=</span> <span class="fu">c</span>(<span class="st">"H"</span>,<span class="st">"S"</span>, <span class="st">"D"</span>)))</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a><span class="co">#Initiallize the first row</span></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a><span class="co">#Insert the number of people who are initially 'H'ealthy, 'S'ick, and 'D'ead in the first row of the cohort trace.</span></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a><span class="co">#TYPE YOUR CODE HERE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Each row of the cohort trace matrix corresponds to one timestep in our model. Next. we will oop over each of then and perform calculations that ‘move’ cohort members between the health states according to our transition probabilities. You should be able to derive these calculations using the following information:</p>
<ul>
<li><p>For any given transition <span class="math inline">\(A \rightarrow B\)</span>, the number of people making it from timestep <span class="math inline">\(i-1\)</span> to <span class="math inline">\(i\)</span> is equal to the number of people in <span class="math inline">\(A\)</span> at timestep <span class="math inline">\(i-1\)</span> times the transition probability <span class="math inline">\(p_{A \rightarrow B}\)</span>.</p></li>
<li><p>Anyone who doesn’t transition out of a state remains there in the next timestep.</p></li>
<li><p>The number of people in state <span class="math inline">\(A\)</span> at timestep <span class="math inline">\(i\)</span> equals the number of people in <span class="math inline">\(A\)</span> at timestep <span class="math inline">\(i-1\)</span>, <strong>plus</strong> all the people who transitioned in, <strong>minus</strong> all the people who transitioned out.</p></li>
</ul>
<p>NOTE: In the R programming language, the first element of a vector has index 1 (in contrast to Python, where the first element has index 0). In our cohort trace, the ‘time=0’ realization of the cohort is stored in the first row of the matrix, or the row <code>m_cohort_trace[1, ]</code>. Because of R indexing, row <code>m_cohort_trace[i+1, ]</code> corresponds to the ith timestep, and row <code>m_cohort_trace[i, ]</code> corresponds to the (i-1)th timestep.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Loop over each timestep and calculate the number of people in each healthstate, using the distribution from the previous timestep (the previous row of the cohort trace matrix) and the transition probabilities (in your parameter list)</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(<span class="fu">dim</span>(m_cohort_trace)[<span class="dv">1</span>]<span class="sc">-</span><span class="dv">1</span>)){</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Healthy state (I've done it for you)</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  m_cohort_trace[i<span class="sc">+</span><span class="dv">1</span>, <span class="st">"H"</span>] <span class="ot">&lt;-</span>(</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>    m_cohort_trace[i, <span class="st">"H"</span>]<span class="sc">+</span><span class="co">#H at last timestep</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>    m_cohort_trace[i, <span class="st">"S"</span>]<span class="sc">*</span>l_prms<span class="sc">$</span>p_S_to_H<span class="sc">+</span><span class="co">#transitions in from S</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>    <span class="sc">-</span><span class="dv">1</span><span class="sc">*</span>m_cohort_trace[i, <span class="st">"H"</span>]<span class="sc">*</span>l_prms<span class="sc">$</span>p_H_to_S<span class="sc">+</span><span class="co">#transitions out to S</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>    <span class="sc">-</span><span class="dv">1</span><span class="sc">*</span>m_cohort_trace[i, <span class="st">"H"</span>]<span class="sc">*</span>l_prms<span class="sc">$</span>p_H_to_D<span class="co">#transitions out to D</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Sick state (H can go to S, S can go to H, S can go to D)</span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">#YOUR CODE HERE</span></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Dead state (H can go to D, S can go to D, no resurrections)</span></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>  <span class="co">#YOUR CODE HERE</span></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>One property of Markov model is that the number of people is conserved at each timestep. No one ‘escapes’ the model. Therefore, summing across any row of the cohort trace matrix should give you the same value; the original cohort size. Try it.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Sum across each row of the cohort matrix</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="co">#HINT: ?rowSums()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next, we can plot the cohort trace to look at how our cohort transitions over time. You do not need to change anything here; if the preceding chunks are correct, running this chunk after them should produce the trace plot.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co">#change cohort trace matrix to dataframe (needed for ggplot)</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>df_cohort_trace <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(m_cohort_trace)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Add timestep as a column. </span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>df_cohort_trace<span class="sc">$</span>timestep <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="fu">nrow</span>(df_cohort_trace)<span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co">#Convert data.table to long format with three columns</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>df_cohort_trace_long <span class="ot">&lt;-</span> tidyr<span class="sc">::</span><span class="fu">gather</span>(df_cohort_trace,</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">key =</span> state,</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">value =</span> count,</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>                                      H<span class="sc">:</span>D)</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a><span class="co">#Plot</span></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>df_cohort_trace_long,</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> timestep, <span class="at">y =</span> count, <span class="at">color =</span> state))<span class="sc">+</span></span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span> <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="dv">0</span>, <span class="dv">10000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 6 row(s) containing missing values (geom_path).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 6 rows containing missing values (geom_point).</code></pre>
</div>
<div class="cell-output-display">
<p><img src="assign0_getting-started_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Now that we’ve gotten a model working, we will want to put it into a function to make it easier to re-run on different parameter sets. Copy and paste code from the prior chunks into the function so that it takes a list of parameters as inputs and returns a cohort trace dataframe.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Input: a list of model parameters</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="co">#Output: cohort trace of the Markov model as a dataframe, which includes a column for timestep</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>run_Markov_model <span class="ot">&lt;-</span> <span class="cf">function</span>(l_prms){</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Code here</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(df_cohort_trace)</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can explore how different inputs change our Markov trace diagram through scenario analysis. To do so, we will create 3 alternative parameter sets, each of which have 1-2 changes from our base case set. Create those parameter sets in the code chunk below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co">#With vaccine: probability of healthy to sick is decreased to 1%</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>l_prms_vaccine <span class="ot">&lt;-</span> l_prms <span class="co">#Copy the parameters</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>l_prms_vaccine<span class="sc">$</span>p_H_to_S <span class="ot">&lt;-</span> <span class="fl">0.01</span> <span class="co">#Change one value</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="co">#Deadlier variant: probability of sick to dead is increased to 12%</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>l_prms_deadlier <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a><span class="co">#IMPLEMENT THE CHANGE</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a><span class="co">#Deadlier variant with vaccine: probability of healthy to sick is 1%; probability of sick to dead is 12%</span></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>l_prms_deadlier_vaccine <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a><span class="co">#IMPLEMENT THE TWO CHANGES</span></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a><span class="co">#Now, use the function you created + the scenarios to create three additional Markov trace dataframes; one for each of the scenarios</span></span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>df_trace_vaccine <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>df_trace_deadlier <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>df_trace_deadlier_vaccine <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a><span class="co">#For plotting, we want to make a dataframe with all 4 scenarios (original + 3 new) with the data in long format, with two extra columns to define the scenario: variant (original or new) and vaccine (with vaccine, no vaccine).</span></span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a><span class="co">#Original variant, no vaccine (I've done this for you)</span></span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a>df_scenarios <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="st">"variant"</span> <span class="ot">=</span> <span class="st">"Original"</span>,</span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"vaccine"</span> <span class="ot">=</span> <span class="st">"No vaccine"</span>,</span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a>                      tidyr<span class="sc">::</span><span class="fu">gather</span>(df_cohort_trace,</span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">key =</span> state,</span>
<span id="cb32-25"><a href="#cb32-25" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">value =</span> count,</span>
<span id="cb32-26"><a href="#cb32-26" aria-hidden="true" tabindex="-1"></a>                                      H<span class="sc">:</span>D))</span>
<span id="cb32-27"><a href="#cb32-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-28"><a href="#cb32-28" aria-hidden="true" tabindex="-1"></a><span class="co">#use rbind() to append each of the new scenarios</span></span>
<span id="cb32-29"><a href="#cb32-29" aria-hidden="true" tabindex="-1"></a><span class="co"># vaccine (original)</span></span>
<span id="cb32-30"><a href="#cb32-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-31"><a href="#cb32-31" aria-hidden="true" tabindex="-1"></a><span class="co"># variant (no vaccine)</span></span>
<span id="cb32-32"><a href="#cb32-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-33"><a href="#cb32-33" aria-hidden="true" tabindex="-1"></a><span class="co"># variant (with vaccine)</span></span>
<span id="cb32-34"><a href="#cb32-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-35"><a href="#cb32-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-36"><a href="#cb32-36" aria-hidden="true" tabindex="-1"></a><span class="co">#now we'll use facet_plot to make a plot with each scenario in a panel</span></span>
<span id="cb32-37"><a href="#cb32-37" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>df_scenarios,</span>
<span id="cb32-38"><a href="#cb32-38" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> timestep, <span class="at">y =</span> count, <span class="at">color =</span> state))<span class="sc">+</span></span>
<span id="cb32-39"><a href="#cb32-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span> <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb32-40"><a href="#cb32-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb32-41"><a href="#cb32-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="dv">0</span>, <span class="dv">10000</span>)<span class="sc">+</span></span>
<span id="cb32-42"><a href="#cb32-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="at">rows =</span> <span class="fu">vars</span>(vaccine), <span class="at">cols =</span> <span class="fu">vars</span>(variant))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 6 row(s) containing missing values (geom_path).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 6 rows containing missing values (geom_point).</code></pre>
</div>
<div class="cell-output-display">
<p><img src="assign0_getting-started_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Finally, compare the scenarios in terms of total deaths.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co">#How many total deaths were there under each scenario</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>total_deaths <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">original_variant_no_vac =</span> <span class="cn">NA</span>,</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">original_variant_vaccine =</span> <span class="cn">NA</span>,</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">new_variant_no_vac =</span> <span class="cn">NA</span>,</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">new_variant_vaccine =</span> <span class="cn">NA</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>total_deaths</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$original_variant_no_vac
[1] NA

$original_variant_vaccine
[1] NA

$new_variant_no_vac
[1] NA

$new_variant_vaccine
[1] NA</code></pre>
</div>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co">#How many deaths does the vaccine avert with the original variant?</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="co">#How many deaths does the vaccine avert with the new variant?</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>